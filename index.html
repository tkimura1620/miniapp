<!doctype html>
const LIFF_ID = "YOUR_LIFF_ID_HERE";


// 今日の日付を既定値に
const elDate = document.getElementById("date");
elDate.value = new Date().toISOString().slice(0, 10);


async function main(){
await liff.init({ liffId: LIFF_ID });
if (!liff.isLoggedIn()) { liff.login(); return; }


const prof = await liff.getProfile();
document.getElementById("hello").textContent = `こんにちは、${prof.displayName} さん`;


document.getElementById("form").addEventListener("submit", async (e) => {
e.preventDefault();
const fd = new FormData(e.currentTarget);
const date = fd.get("date");
const statusVal = fd.get("status");
const note = fd.get("note") || "";
if (!date || !statusVal) { alert("日付とステータスを入力してください"); return; }


const idToken = liff.getIDToken();


const res = await fetch("/api/attendance", {
method: "POST",
headers: { "Content-Type": "application/json" },
body: JSON.stringify({
idToken,
payload: { date, status: statusVal, note }
}),
});


const status = document.getElementById("status");
if (res.ok) {
status.textContent = "出席連絡を受け付けました。ありがとうございました！";
if (liff.isInClient()) setTimeout(() => liff.closeWindow(), 800);
} else {
const t = await res.text().catch(()=> "");
status.textContent = "送信に失敗しました " + t;
}
});
}
main().catch(err => alert(err?.message || err));
</script>
</body>
</html>
